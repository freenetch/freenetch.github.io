<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
        <link rel="canonical" href="https://freenetch.github.io/news/article-75498.htm" />
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>树莓派4B基于OpenCV的C++环境的串口通信</title>
        <meta name="description" content="第二次积分赛我们队选择了飞控，我负责图像方面，我先简要说明一下该题中树莓派所需要的功能：用OpenCV图像处理进行巡线，同时识别红圆和绿圆。然后就是关键的一步，树莓派与飞控的通信。  树莓派将处理好的" />
        <link rel="icon" href="/assets/website/img/freenetch/favicon.ico" type="image/x-icon"/>

    <meta name="author" content="Free Netch机场节点分享官网">
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://freenetch.github.io/news/article-75498.htm" />
    <meta property="og:site_name" content="Free Netch机场节点分享官网" />
    <meta property="og:title" content="树莓派4B基于OpenCV的C++环境的串口通信" />
    <meta property="og:image" content="https://freenetch.github.io/uploads/20240908-3/d82581d2c0ced18795dea383e460a608.webp" />
        <meta property="og:release_date" content="2025-03-17T09:39:39" />
    <meta property="og:updated_time" content="2025-03-17T09:39:39" />
        <meta property="og:description" content="第二次积分赛我们队选择了飞控，我负责图像方面，我先简要说明一下该题中树莓派所需要的功能：用OpenCV图像处理进行巡线，同时识别红圆和绿圆。然后就是关键的一步，树莓派与飞控的通信。  树莓派将处理好的" />
        
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="applicable-device" content="pc,mobile" />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta name="robots" content="max-image-preview:large" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="树莓派4B基于OpenCV的C++环境的串口通信">
    <meta name="format-detection" content="telephone=no">

    <link rel="dns-prefetch" href="https:/www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googleadservices.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
    <link rel="dns-prefetch" href="https://cm.g.doubleclick.net">
    
    <!-- CSS
    ============================================ -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/website/css/freenetch/bootstrap.min.css">
    <!-- Icon Font CSS -->
    <link rel="stylesheet" href="/assets/website/css/freenetch/icon-font.min.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="/assets/website/css/freenetch/plugins.css">
    <!-- Main Style CSS -->
    <link rel="stylesheet" href="/assets/website/css/freenetch/style.css">
    <!-- Modernizer JS -->
    <script src="/assets/website/js/frontend/freenetch/vendor/modernizr-2.8.3.min.js"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MJN687PNRB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MJN687PNRB');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body data-page="detail">
        <!-- Header Section Start -->
    <div class="header-section section">
        <!-- Header Bottom Start -->
        <div class="header-bottom header-bottom-one header-sticky">
            <div class="container">
                <div class="row align-items-center justify-content-between">
                    <div class="col mt-15 mb-15">
                        <!-- Logo Start -->
                        <div class="header-logo">
                            <a href="/">
                                                        <span>Free Netch</span>
                                                        </a>
                        </div><!-- Logo End -->
                    </div>
                    <div class="col order-12 order-lg-2 order-xl-2 d-none d-lg-block">
                        <!-- Main Menu Start -->
                        <div class="main-menu">
                            <nav>
                                <ul>
                                                                        <li><a href="/">首页</a></li>
                                                                        <li><a href="/free-nodes/">免费节点</a></li>
                                                                        <li><a href="/paid-subscribe/">推荐机场</a></li>
                                                                        <li><a href="/client.htm">客户端</a></li>
                                                                        <li><a href="/news/">新闻资讯</a></li>
                                                                    </ul>
                            </nav>
                        </div><!-- Main Menu End -->
                    </div>
                    <!-- Mobile Menu -->
                    <div class="mobile-menu order-12 d-block d-lg-none col"></div>
                </div>
            </div>
        </div><!-- Header Bottom End -->
    </div><!-- Header Section End -->
    <!-- Page Banner Section Start -->
    <div class="page-banner-section section">
        <div class="page-banner-wrap row row-0 d-flex align-items-center ">
            <!-- Page Banner -->
            <div class="col-12 d-flex align-items-center justify-content-center">
                <div class="page-banner">
                    <h1>树莓派4B基于OpenCV的C++环境的串口通信</h1>
                    <div class="breadcrumb">
                        <ul>
                            <li><a href="/">首页</a></li>
                            <li><a href="/news/">新闻资讯</a></li>
                            <li>正文</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- Page Banner Section End -->
    <div class="feature-section section mt-60 mb-60">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                                    <input type="hidden" id="share-website-info" data-name="" data-url="">
                  				  				  				<blockquote> <p>第二次积分赛我们队选择了飞控，我负责图像方面，我先简要说明一下该题中树莓派所需要的功能：用OpenCV图像处理进行巡线，同时识别红圆和绿圆。然后就是关键的一步，树莓派与飞控的<strong>通信</strong>。</p> </blockquote> <p>树莓派将处理好的数据（为巡线所确定的点、圆心等）发送给飞控，飞控端再通过PID等算法对接收到的数据进行解析，从而控制飞行器的运动。在这里就需要树莓派与飞控通信，我们选择了简单的<strong>uart串口通信</strong>。</p> <p>本以为会比较顺利，因为树莓派在网上有很多的开源教程，我也找了许多的教程一步步试，费尽了许多周折将串口配置好、下载的库也配置好，程序也编译通过，但是和CH340连电脑，就。。。啥也没显示。。。：-）此时我的心是悲剧的。</p> <p></p> <p>最终找了学长才解决的问题。（这里先感谢srh学长！！学长也超级耐心!）</p> <p>目前网上找到的大多数关于树莓派 4B 串口的文章，包括B站树小悉的视频教程，大都是将<strong>硬件串口（ttyAMA0，UART0）</strong>设置为<strong>主串口（Serial0）</strong>并<strong>关闭蓝牙</strong>，这个做法针对树莓派<strong>3B</strong>及以下是必须的，因为本身串口不够用。但对树莓派<strong>4B</strong> 来说并不需要，因为有额外 4 个串口可以利用，默认配置好的硬件串口和miniUART 可以保留设置。我参考了网上的教程，但就是无法串口收发数据，不过<strong>使用树莓派的这额外四个串口</strong>就成功了。（<strong>串口相关的具体可以查看<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://www.raspberrypi.com/documentation/computers/configuration.html"  target="_blank" rel="nofollow">这篇官方文档</a></strong>，用浏览器自带网页搜索“serial”可以较快查到）</p> <p>然后，在配置WiringPi库的时候也遇到了<strong>版本</strong>和<strong>加入OpenCV环境</strong>等问题。</p> <p>话不多说，先分享我的配置过程，也为了让后来人少走一些弯路。这里先默认读者已经会使用树莓派的基本操作，且已经装好OpenCV的C++环境，并且会cmake编译运行。如果不会，请参考<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://blog.csdn.net/Lin_QC/article/details/104392936"  target="_blank" rel="nofollow">这篇文章</a>。下面的操作也是基于这篇文章的基础之上的。</p> </h1> <h2 id="1-展示所有串口命令">1. 展示所有串口命令</h2> <p>命令行输入：</p> <pre><code class="language-C++">dtoverlay -a | grep uart</code></pre> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/e9356f5e7505f373b905360c69d3938f.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> <h2 id="2-查看串口信息">2. 查看串口信息</h2> <p>我们来康康树莓派4B额外4个串口之一的uart2，命令行输入：</p> <pre><code class="language-C++">dtoverlay -h uart2</code></pre> <p>可以查看到配置信息：</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/58e675af126c5097dba2a742a957d8c2.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> <p>相关信息会展现 GPIOs 与树莓派4B额外的4个UART 串口的分配：0-3 对应 UART2， 4-7 对应 UART3，8-11 对应 UART 4，以及 12-15 对应UART 5。</p> <h2 id="3-开启串口-uart2-5">3. 开启串口 UART2-5</h2> <p>执行编辑 config.txt 命令，命令行输入：</p> <pre><code class="language-C++">sudo nano /boot/config.txt</code></pre> <p>拉到文件结尾，添加如下代码：</p> <pre><code class="language-C++">dtoverlay=uart2 dtoverlay=uart3 dtoverlay=uart4 dtoverlay=uart5</code></pre> <p>按ctrl+x，然后保存，enter退出。</p> <p>重启树莓派，命令行输入：</p> <pre><code class="language-C++">sudo reboot</code></pre> <p>重启后查看串口是否打开，命令行输入：</p> <pre><code class="language-C++">ls /dev/ttyAMA*</code></pre> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/8ee25bf0ce7358e421ba7f6b52ea0baf.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> <p>可以看到几个串口都打开了。（AMA1-4分别对应UART2-5）</p> <h2 id="4串口接线">4、串口接线</h2> <p>接下来我们看看这4个串口分别对应于树莓派的哪些引脚：</p> <pre><code class="language-C++">UART0： GPIO14 = TXD0 -&gt; ttyAMA0     GPIO15 = RXD0 -&gt; ttyAMA0 UART2： GPIO0  = TXD2 -&gt; ttyAMA1     GPIO1  = RXD2 -&gt; ttyAMA1 UART3： GPIO4  = TXD3 -&gt; ttyAMA2     GPIO5  = RXD3 -&gt; ttyAMA2 UART4： GPIO8  = TXD4 -&gt; ttyAMA3     GPIO9  = RXD4 -&gt; ttyAMA3 UART5： GPIO12 = TXD5 -&gt; ttyAMA4     GPIO13 = RXD5 -&gt; ttyAMA4</code></pre> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/63d352239f45d64f4acd9dd8c0f9b0d5.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> <p>我们这里使用UART2，可以看到 GPIO0对应于uart2的TX（引脚编号为27），GPIO1对应于uart2的RX（引脚编号为28）。故将CH340的TX和28号引脚相连，RX引脚和27号引脚相连，GND和30号引脚相连共地。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/0a4e52317538de1a74a10cbde909db8d.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> </h1> <blockquote> <p>什么？WiringPi？你确定是WiringPi？不是WritingPi？没错，你的英语没问题，就是WiringPi。。：-）</p> </blockquote> <p>WiringPi是一个用C语言编写的树莓派软件包，可用于树莓派GPIO引脚控制、串口通信、SPI通信及I2C通信等功能。其官方网址为<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://link.zhihu.com/?target=http%3A//wiringpi.com"  target="_blank" rel="nofollow">http://wiringpi.com</a>。我们可以看到这个库作者已经停止维护了。我们在这里用的是串口通信，故只用它的wiringSerial库。</p> <p>安装WiringPi，我试了试若直接<code>apt-get install wiringpi</code>的话不行，只能卡在2.32版本，而树莓派4B要树莓派2.52版本才行。（有可能是我安装的问题）好在 GitHub 仓库上的有源码可以下载。</p> <p>在命令行输入：</p> <pre><code class="language-C++">git clone https://github.com/WiringPi/WiringPi.git cd ~/wiringPi ./build</code></pre> <p>这样我们就在<code>wiringPi</code>目录下安装好了WiringPi库。</p> <p>我们查看一下版本，在命令行中输入：</p> <pre><code class="language-C++">gpio -v</code></pre> <p>可以看到版本号是 2.7。在树莓派4B上可以正常使用。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/4bec4be3252fba2a811ed30483975a05.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> </h1> <p>cmake原来OpenCV程序时（OpenCV相关目录下已创建cpp文件test_opencv.cpp）需要在CMakeLists.txt里写如下代码：（如不懂，具体还是请看<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://blog.csdn.net/Lin_QC/article/details/104392936"  target="_blank" rel="nofollow">这篇文章</a>）</p> <pre><code class="language-C++">cmake_minimum_required(VERSION 2.6) project(test_opencv) find_package(OpenCV REQUIRED) add_executable(test_opencv test_opencv.cpp) target_link_libraries(test_opencv ${OpenCV_LIBS})</code></pre> <p>要加入WiringPi库，只需在CMakeLists.txt里写：</p> <pre><code class="language-C++">cmake_minimum_required(VERSION 2.6) add_definitions( -lwiringPi  ) project(test_opencv) find_package(OpenCV REQUIRED) find_library(WIRINGPI_LIBRARIES NAMES wiringPi) add_executable(test_opencv test_opencv.cpp) target_link_libraries(test_opencv ${OpenCV_LIBS}) target_link_libraries(test_opencv ${WIRINGPI_LIBRARIES}  -lpthread)    //-lpthread后缀要写上，否则编译会不通过</code></pre> </h1> <p>使用WiringPi库来串口通信要包含头文件：</p> <pre><code class="language-C++">#include &lt;wiringPi.h&gt; #include &lt;wiringSerial.h&gt;</code></pre> <p>其实用wiringSerial.h就可以了。</p> <p>在main函数里写串口初始化代码：</p> <pre><code class="language-C++">wiringPiSetup();</code></pre> <p>然后打开串口2，并设一个变量fd来作为串口文件描述符：</p> <pre><code class="language-C++">int fd =serialOpen("/dev/ttyAMA1",9600);   //这里波特率设置为9600</code></pre> <p>发送函数：</p> <pre><code class="language-C++">//写在while里，每隔3秒发送一个hello world!! serialPrintf(fd,"hello world!!\n");    delay(3000);</code></pre> <p>功能类似于printf，可以同时发送多个字符串。</p> <p>注：</p> <p><strong>以上发送函数只是把数据推送到发送缓冲区里，不会等待串口发送完成。</strong>后续程序如果要用到用到串口返回数据应当要考虑到串口传输时间。<strong>并且最好等之前的数据全部发送完成后再发送新数据，否则可能会出问题，这也要考虑到串口发送数据的时间，可能需要等待。</strong></p> <p>我们在项目的目录下输入：</p> <pre><code class="language-C++">cmake . make ./test_opencv</code></pre> <p>可以编译并运行程序了！编译也没有报错！</p> <p>这样电脑端可以在串口调试助手上接收到数据。图中是vofa上接收数据情况。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220510/4e010a93ab9d53fcca044af3423b247a.jpg" alt="树莓派4B基于OpenCV的C++环境的串口通信"></p> <p>当然，我们串口通信是为了发送图像处理后的数据，并和我们的飞控通信，在树莓派端，我们需要将需要的数据打包成帧，建立一个自己写的通信协议，发送给飞控，飞控端解析这些数据帧就可以了。这些会在第二次积分赛总结里写，不过估计要鸽到暑假了。:-）</p> <p>参考文章：</p> <p><a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://blog.csdn.net/weixin_40796925/article/details/107907991"  target="_blank" rel="nofollow">https://blog.csdn.net/weixin_40796925/article/details/107907991</a></p> 			                <div class="clearfix"></div>
                <div class="col-md-12 mt-5">
                                        <p>上一个：<a href="/news/article-74828.htm">2021公务员国考报名公告（2021国考公务员招考公告）</a></p>
                                        <p>下一个：<a href="/news/article-75499.htm">狗狗送人领养怎么说（狗狗送人领养怎么说祝福语）</a></p>
                                    </div>
                                </div>
                <div class="col-md-3">
                    <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/free-nodes/2025-2-27-free-node-subscribe-links.htm" title="2月27日→19.3M/S|2025年最新免费节点Free Netch订阅链接地址">2月27日→19.3M/S|2025年最新免费节点Free Netch订阅链接地址</a></li>
                        <li class="py-2"><a href="/news/article-71505.htm" title="宠物领养软件有哪些好用的软件（宠物领养软件下载）">宠物领养软件有哪些好用的软件（宠物领养软件下载）</a></li>
                        <li class="py-2"><a href="/news/article-60304.htm" title="猫三联每一针间隔时间多久（猫三联一针多少）">猫三联每一针间隔时间多久（猫三联一针多少）</a></li>
                        <li class="py-2"><a href="/news/article-43917.htm" title="docker存储路径修改">docker存储路径修改</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-10-free-netch-node.htm" title="3月10日→19.5M/S|2025年最新免费节点Free Netch订阅链接地址">3月10日→19.5M/S|2025年最新免费节点Free Netch订阅链接地址</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-1-25-share-netch-node.htm" title="1月25日→22.7M/S|2025年最新免费节点Free Netch订阅链接地址">1月25日→22.7M/S|2025年最新免费节点Free Netch订阅链接地址</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-2-free-node-subscribe-links.htm" title="3月2日→21.7M/S|2025年最新免费节点Free Netch订阅链接地址">3月2日→21.7M/S|2025年最新免费节点Free Netch订阅链接地址</a></li>
                        <li class="py-2"><a href="/news/article-48295.htm" title="手写事件发布订阅框架">手写事件发布订阅框架</a></li>
                        <li class="py-2"><a href="/news/article-67596.htm" title="宠物猫疫苗费用（宠物猫接种疫苗多少钱）">宠物猫疫苗费用（宠物猫接种疫苗多少钱）</a></li>
                        <li class="py-2"><a href="/news/article-38462.htm" title="宠物粮食加工厂加盟条件及费用标准最新（宠物粮食加工厂怎么起步）">宠物粮食加工厂加盟条件及费用标准最新（宠物粮食加工厂怎么起步）</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">57</span> <a href="/date/2025-03/" title="2025-03 归档">2025-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">84</span> <a href="/date/2025-02/" title="2025-02 归档">2025-02</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">84</span> <a href="/date/2025-01/" title="2025-01 归档">2025-01</a></h4>
            </li>
                    </ul>
    </div>
</div>

                </div>
            </div>
        </div>
    </div><!-- Feature Section End -->
        <!-- Footer Section Start -->
    <div class="footer-section section bg-ivory">
        <!-- Footer Bottom Section Start -->
        <div class="footer-bottom-section section">
            <div class="container">
                <div class="row">
                    <!-- Footer Copyright -->
                    <div class="col-lg-6 col-12">
                        <div class="footer-copyright">
                            <p>
                                <a href="/">首页</a> | 
                                <a href="/free-node/">免费节点</a> | 
                                <a href="/news/">新闻资讯</a> |
                                <a href="/about-us.htm">关于我们</a> |
                                <a href="/disclaimer.htm">免责申明</a> |
                                <a href="/privacy.htm">隐私申明</a> |
                                <a href="/sitemap.xml">网站地图</a>
                            </p>
                            <p>
                                <a href="/">Free Netch机场节点分享官网</a> 版权所有
                                <br />
                                Powered by WordPress
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- Footer Bottom Section Start -->
    </div><!-- Footer Section End -->
    <!-- Popup Subscribe Section Start -->
    
    <!-- JS
============================================ -->
    <!-- jQuery JS -->
    <script src="/assets/website/js/frontend/freenetch/vendor/jquery-1.12.4.min.js"></script>
    <!-- Popper JS -->
    <script src="/assets/website/js/frontend/freenetch/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="/assets/website/js/frontend/freenetch/bootstrap.min.js"></script>
    <!-- Plugins JS -->
    <script src="/assets/website/js/frontend/freenetch/plugins.js"></script>
    <!-- Ajax Mail -->
    <script src="/assets/website/js/frontend/freenetch/ajax-mail.js"></script>
    <!-- Main JS -->
    <script src="/assets/website/js/frontend/freenetch/main.js"></script>
    <script src="https://www.freeclashnode.com/assets/js/frontend/invite-url.js"></script><script src="/assets/website/js/frontend/G.js"></script>
</body>

</html>